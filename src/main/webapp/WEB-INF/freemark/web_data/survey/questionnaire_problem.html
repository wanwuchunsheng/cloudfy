<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en" class="no-js">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
<title>问卷问题-列表添加</title>
		<link href="${resRoot}/media/odstl/css/font-awesome.min.css" rel="stylesheet" />
		<link href="${resRoot}/media/odstl/css/bootstrap.min.css" rel="stylesheet" />
		<link href="${resRoot}/media/odstl/css/uniform.default.css" rel="stylesheet" />
		<link href="${resRoot}/media/odstl/css/select2_metro.css" rel="stylesheet"  />
		<link href="${resRoot}/media/odstl/css/DT_bootstrap.css"  rel="stylesheet"  />
		<link href="${resRoot}/media/odstl/css/datepicker.css" rel="stylesheet">
		<link href="${resRoot}/media/odstl/css/datetimepicker.css" rel="stylesheet">
		<link href="${resRoot}/media/odstl/css/style-metronic.css" rel="stylesheet" />
		<link href="${resRoot}/media/odstl/css/style.css" rel="stylesheet" />
		<link href="${resRoot}/media/odstl/css/custom.css" rel="stylesheet" />

		<script src="${resRoot}/media/odstl/js/jquery-1.10.2.min.js" type="text/javascript"></script> 
		<script src="${resRoot}/media/odstl/js/jquery-migrate-1.2.1.min.js" type="text/javascript"></script> 
		<script src="${resRoot}/media/odstl/js/bootstrap.min.js" type="text/javascript"></script> 
		<script src="${resRoot}/media/odstl/js/twitter-bootstrap-hover-dropdown.min.js" type="text/javascript"></script> 
		<script src="${resRoot}/media/odstl/js/jquery.cokie.min.js" type="text/javascript"></script> 
		<script src="${resRoot}/media/odstl/js/jquery.uniform.min.js" type="text/javascript"></script> 
		<script src="${resRoot}/media/odstl/js/select2.min.js" type="text/javascript" ></script> 
		<script src="${resRoot}/media/odstl/js/jquery.dataTables.js" type="text/javascript" ></script> 
		<script src="${resRoot}/media/odstl/js/DT_bootstrap.js" type="text/javascript" ></script> 
		<script src="${resRoot}/media/odstl/js/bootstrap-datepicker.js" type="text/javascript" ></script> 
		<script src="${resRoot}/media/odstl/js/bootstrap-datepicker.zh-CN.js" type="text/javascript" ></script> 
		<script src="${resRoot}/media/odstl/js/jquery.ui.widget.js" type="text/javascript" ></script>
		<script src="${resRoot}/media/odstl/js/jquery.iframe-transport.js" type="text/javascript" ></script>
		<script src="${resRoot}/media/odstl/js/jquery.fileupload.js" type="text/javascript" ></script>
		<script src="${resRoot}/media/odstl/js/jquery.fileupload-process.js" type="text/javascript" ></script>
		<script src="${resRoot}/media/odstl/js/jquery.fileupload-validate.js" type="text/javascript" ></script>
		<script src="${resRoot}/media/odstl/js/alert_message.js" type="text/javascript"></script>
		<script src="${resRoot}/media/odstl/js/app.js" type="text/javascript"></script>
		<script src="${resRoot}/media/odstl/js/index.js" type="text/javascript"></script>
		<script src="${resRoot}/media/odstl/js/global.js" type="text/javascript"></script>
		<script src="${resRoot}/media/odstl/js/Date.js" type="text/javascript"></script>
		
	</head>
	<!-- END HEAD -->
	<!-- BEGIN BODY -->
	<body class="header-fixed-body" >
	<!-- BEGIN CONTENT -->
	<div class="page-content-wrapper">
		<div class="page-content">
			 <!-- 面包线start  -->
                <div class="row">
					  <div class="col-md-12">
					    <h3 class="page-title">问卷问题</h3>
					    <ul class="page-breadcrumb breadcrumb">
					            <li>
					                <i class="fa fa-home"></i>
					                <a href="#">首页</a>
					                <i class="fa fa-angle-right"></i>
					            </li>
					            <li>
					                <i class="fa fa-book"></i>
					                <a href="#">问卷管理</a>
					            </li>
					        </ul>
					  </div>
				</div>
				<!-- 面包线start  -->
			<!-- END PAGE HEADER-->
			<!-- END PAGE HEADER-->
			<form id="requestInfoForm" action="" >
					<!-- BEGIN PAGE MAIN -->
					<div class="portlet box blue">
						<div class="portlet-title">
							<div class="caption">
								问题信息
							</div>
						</div>
						<div class="portlet-body">
							<ul class="nav nav-tabs">
								<li id="titOne" class="active" >
									<a href="#tab_1_1" data-toggle="tab">问题修改</a>
								</li>
							</ul> 
							<div class="tab-content">
								<div class="tab-pane fade active in" id="tab_1_1">
									<div class="form-horizontal clearfix custom-form">
										<div class="row">
											<div class="form-group">
												<label class="col-md-2 control-label text-right">问卷标题:</label>
												<div class="col-md-7">
													<input name="shortName" readonly="readonly" id="shortName" type="text" class="form-control" value = "${que.title?if_exists}" />
													<input name="questionnaireId" id="questionnaireId" type="hidden" class="form-control" value = "${que.id?if_exists}" />
												</div>
												
											</div>
										</div>
										<div class="clearfix"></div>
										<div class="row">
											<div class="form-group">
												<label class="col-md-2 control-label text-right">问题序号:</label>
												<div class="col-md-7">
													<input id="code" name="code" type="text" class="form-control" value = "" />
												</div>
												
											</div>
										</div>
										<div class="clearfix"></div>
										<div class="row">
											<div class="form-group">
										       <label class="col-md-2 control-label text-right">题型:</label>
												<div class="col-md-2">
													<select  id="type"  name="type" class="form-control " tabindex="-1">
													    <option value="400011009" >单选</option>
														<option value="400011001" >单选文本</option>
														<option value="400011002" >多选</option>
														<option value="400011003" >文本</option>
														<option value="400011004" >下拉 </option>
													    
													</select>
												</div>
												 <label class="col-md-2 control-label text-right">是否必填:</label>
												<div class="checkbox col-md-4">
													 <label class="radio-inline"><input type="radio" checked="checked" name="isRequired" value="10000" />否</label>
														<label class="radio-inline"><input type="radio" name="isRequired" value="10001" />是</label>
												</div>
											</div>
											
										</div>
										<div class="clearfix"></div>
										<div class="row">
											<div class="form-group">
												<label class="col-md-2 control-label text-right">问卷问题:</label>
												<div class="col-md-10">
													<textarea style="font-size:11px;" name="fullName" id="fullName" type="text"  class="form-control" rows="6" ></textarea>
													<span style="color:red;font-size:12px;">友情提醒：录入”请问你是**先生吗？“，点击◎姓名后再输入“先生吗？”</span>
												</div>
												
											</div>
										</div>
										<div class="clearfix"></div>
										 <div class="row">
											  <div class="col-md-10">
		                                          <div class="form-group">
		                                               <label class="col-md-2 control-label text-right"></label>
														<div class="col-md-10" id="field">
															<label class="radio-inline"><input onclick="addFullName(this)" type="radio" name="selInput"  value="<br/>" />换行</label>
															<label class="radio-inline"><input onclick="addFullName(this)" type="radio" name="selInput"  value="nbsp" />空格</label>
															<label class="radio-inline"><input onclick="addFullName(this)" type="radio" name="selInput" value="<font color='#F00'>" />红字体开始</label> 
															<label class="radio-inline"><input onclick="addFullName(this)" type="radio" name="selInput" value=" </font>" />红字体结束</label>
														</div>
		                                          </div>
		                                      </div>
										</div>
									</div>
									</div>
							</div>
						</div>
					</div>
					<br/>
					<div class="clearfix"></div>
						<div class="row" style="margin-left:3px;">
							<div class="btn-group">
								<a type="button" onclick="addQueProButton()"
									class="btn green"> 添加 <i class="fa fa-plus"></i>
								</a>
							</div>
							
							<div class="btn-group">
								<a type="button" onclick="deleteButton()"
									class="btn red"> 删除 <i class="fa fa-times"></i>
								</a>
							</div>
							<div class="btn-group">
								<input onclick="updateButton()" type="button"
									class="btn green" value="修改" />
							</div>
							<div class="btn-group">
								<input type="reset" class="btn green"/> 
							</div>
							<div class="btn-group">
							     <input onclick="backButton()" type="button" class="btn gary" value="返回" />
							</div>
						</div>
					    <div class="clearfix"></div>
				</form>
				<br/>
				</div>
				<!-- 问题添加end -->
				<div style="overflow:scroll;">
				<table class="table table-striped table-bordered table-hover" id="table_s1">
					<thead style="width:1500px;">
						<tr>
							<th class="table-checkbox"><input type="checkbox"
								class="group-checkable" data-set="#table_s1 .checkboxes" />
							</th>
							<th>问题编号</th>
							<th>问题</th>
							<th>题型</th>
							<th>创建人</th>
							<th>创建时间</th>
							<th>是否必填</th>
							<th>操作</th>
						</tr>
					</thead>
					<tbody role="alert" aria-live="polite" aria-relevant="all">

					</tbody>
				</table>
				</div>
				<div class="clearfix"></div>
				<br />
			</div>

						
	<br/><br/>
	<!-- END CONTENT -->
	<!-- 弹出配置客户基本信息窗口 -->
	<div class="modal fade" id="myModalrw1" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"></div>
	<!-- JAVASCRIPTS -->
	
	<script type="text/javascript">
		admin = {

		};
		/**  初始化  */
		$(function(){
			$("select").select2();
			App.init();
			queryPage();//查询
		});

		/**  返回  */
		function backButton() {
			 window.location.href="${request.contextPath}/survey/que/queManageUpdatePage?id="+ ${que.id?if_exists};
		}

		
		/** 分页列表  */
		function queryPage() {
			//$('#table1').dataTable().fnDestroy();
			if( admin.dataTable ){
				admin.dataTable.fnDestroy();
			}
			//显示查询条件
			admin.dataTable = $('#table_s1').dataTable({
				"bFilter" : false,
				"bSort" : false, // 排序功能
				"processing" : true, // 设置异步请求时，是否有等待框。
				"sAjaxSource" : '${futRoot}/survey/que/queryQueManageProblem',
				 "fnServerParams" : function(aoData) {
					   aoData.push({
							"name" : "questionnaireId",
							"value" : ${que.id?if_exists}
						});
					},
				"sServerMethod" : "post",
				"bServerSide" : true, // 异步请求
				"aoColumns" : [{
						"mData" : "id",
						"mRender" : function(data, type,row) {
							if (data) {
								return "<input id='checkBoxt' name='checkBoxt' type='checkbox' class='checkboxes' value="+data+" />";
							}
						}
					},{
						"mData" : "code",
						"mRender" : function(data, type, row) {
							if (data) {
								return data;
							}
						}
					},{
						"mData" : "fullName",
						"mRender" : function(data, type, row) {
							if (data) {
								var html = "<span class='subSpan'>" + data.substr(0, 12) + "...</span><div style='position:absolute;background:#ccc;display:none;'>"+ data + "</div>";
								return html;
							}
						}
					},{
						"mData" : "type",
						"mRender" : function(data, type,row) {
							if (data==400011009) { 
								return "单选";  
							}else if (data==400011001) { 
								return "单选文本";  
							}else if (data==400011002) { 
								return "多选";  
							}else if (data==400011003) { 
								return "文本";  
							}else if (data==400011004) { 
								return "下拉";  
							}else{
                                return "未知";
							}
						}
					},{
						"mData" : "createUserName",
						"mRender" : function(data, type, row) {
							if (data) {
								return data;
							}
						}
					},{
						"mData" : "createTime",
						"mRender" : function(data, type,row) {
							if (data) {
								return new Date(data).format('yyyy-MM-dd hh:mm:ss');
							}
						}
					},{
						"mData" : "isRequired",
						"mRender" : function(data, type,row) {
							if (data == 10001) {
								return "是";
							} else {
								return "否";
							}
						}
					},{
						"mData" : "id",
						"mRender" : function(data, type,row) {
							return "<a onclick='manageButton("+ data+ ")'  class='btn blue' >选项管理<i class='fa fa-edit'></i></a>";
						}
					}],
				"aLengthMenu" : [[5,10, 15, 20], [5,10, 15, 20]],
				"iDisplayLength" : 5,
				"sPaginationType" : "bootstrap",
				"aaSorting" : [[2, "asc"]], //列数
				"aoColumnDefs" : [{
					"sDefaultContent" : '',
					"aTargets" : ["_all"]
				} ],
				"fnServerData" : function(sSource, aoData, fnCallback) {
					$.ajax({
						"dataType" : 'json',
						"type" : "POST",
						"url" : sSource,
						"data" : aoData,
						"success" : fnCallback,
						"timeout" : 3000000, // 连接超时时间
						"error" : function handleAjaxError(xhr, textStatus, error) {
							if (textStatus === "timeout") {
								//$.dopErr("连接超时!请稍后再试!!!");
								$.Alert("连接超时!请稍后再试!!!");
							} else if (textStatus == "error") {
								//$.dopErr("系统繁忙!!!,请稍后再试!!!", null);
								$.Alert("系统繁忙!!!,请稍后再试!!!");
							}
							admin.dataTable.fnProcessingIndicator(false);
							// 这里是把"正在查询几个子去掉，(换成自己的id)
						}
					});
				}, //设置异常处理
				"oLanguage" : {
					"sLengthMenu" : "每页显示 _MENU_ 条记录",
					"sZeroRecords" : "抱歉， 没有找到",
					"sInfo" : "从 _START_ 到 _END_ /共 _TOTAL_ 条数据",
					"sInfoEmpty" : " ",
					"sProcessing" : "正在查询....",
					"sInfoFiltered" : "",
					"oPaginate" : {
						"sFirst" : "首页",
						"sPrevious" : "前一页",
						"sNext" : "后一页",
						"sLast" : "尾页"
					}
				}
				
			});
		}
		
		

		/** 问卷管理*/
		function manageButton(id) {
			window.location.href = "${request.contextPath}/survey/que/questionnaireProblemItem?id="+ id;
		}
		
		/* 删除 */
       function deleteButton(){
    	    //获取ID
	        var item = document.getElementsByName("checkBoxt");
	        var str = "";
	        for (var i = 0; i < item.length; i++) {
	            if (item[i].checked == true) {
	                var k = item[i].value;
	                str+=k+","; 
	            }
	        }
	        //验证是否选中
	        if(str==""){
	        	$.Alert("操作失败：请选择后再操作!");
	        	return false;
	        }else{
			    str=str.substring(0, str.lastIndexOf(','));
			}
	        $.ajax({
				url : "${request.contextPath}/survey/que/deleteQueManageProblem",
				type : "post",
				data : {
                     "ids":str
				},
				success : function(data) {
					if(data){
						//刷新列表
						admin.dataTable.fnDraw();
					}else{
						$.Alert("ERROR:删除失败!!!");
					}
					
				}
			});
       }

		/**  问题序号验证  */
		function addQueProButton() {
			$.post("${request.contextPath}/survey/que/queryQuestionnaireProblemOrCode",{
				code : $("#code").val(),
				questionnaireId : ${que.id?if_exists}
			}, function(data) {
				if (data) {
					addQuestionnaireProblem();
				} else {
					$.Alert("添加失败,问卷编号有重复!");
				}
			});
		}

		/**  问题添加 */
		function addQuestionnaireProblem() {
			//获取参数,
			var shortName = $("#shortName").val();
			var fullName = $("#fullName").val();
			var code = $("#code").val();
			var type = $("#type").val();
			if (shortName == "" || fullName == "" || code == "" || type == "") {
				$.Alert("选项不能为空!");
				return;
			}
			$.ajax({
				url : "${request.contextPath}/survey/que/addQuestionnaireProblem",
				type : "post",
				dataType : "json",
				data : $("#requestInfoForm").serialize(),
				success : function(data) {
				    if(data){
				    	//刷新列表
						admin.dataTable.fnDraw();
				    	$.Alert("提交成功！！！");
					}else{
						$.Alert("提交失败！！!");
					}
					
				}
			});
		}

		/** 单选框-插标签*/
		function addFullName(obj) {
			var val = obj.value;
			if(val=="nbsp"){
				$("#fullName").val($("#fullName").val() +"&nbsp;");
			}else{
				$("#fullName").val($("#fullName").val() + val);
			}
			
		}

		/** 预览 */
		/* function showDatButton() {
	        window.location.href="${request.contextPath}/survey/que/queManageViewPage?id="+${que.id?if_exists};
		} */

		/**  修改*/
		function updateButton() {
			//获取ID
	        var item = document.getElementsByName("checkBoxt");
	        var str = "";
	        for (var i = 0; i < item.length; i++) {
	            if (item[i].checked == true) {
	                var k = item[i].value;
	                str+=k+","; 
	            }
	        }
	        //验证是否选中
	        if(str==""){
	        	$.Alert("操作失败：请选择后再操作!");
	        	return false;
	        }
	        //验证只能选中1条
	        str=str.substring(0, str.lastIndexOf(','));
	        var ids=str.split(",");
		    if(ids.length>1){
	        	$.Alert("操作失败：只能选中一个操作!");
	        	return false;
		    }
		    //跳转到问题修改页面
			window.location.href = "${request.contextPath}/survey/que/questionnaireProblemUpdate.htm?id="+str
		}

		
	</script>
	<!-- END JAVASCRIPTS -->
</body>
<!-- END BODY -->
</html>
